#pragma once

// This contains various regtables

#include <stdint.h>
#include <string.h>

namespace elan {
	struct RegEntry {
		uint8_t address, value;
	};

	struct RegTable {
		int length;
		const RegEntry *values;
	};

	template<int Length>
	struct AutoRegTable {
		operator RegTable() const {
			return data;
		}

		const RegTable& table() const {
			return data;
		}

		AutoRegTable(RegEntry *entries) {
			memcpy(values, entries, sizeof values);
			data.length = Length;
			data.values = values;
		}
	private:
		RegEntry values[Length];
		RegTable data;
	};

	template<typename ...Entries>
	auto create_reg_table(Entries ...entries) {
		const static int Length = sizeof...(Entries);
		RegEntry temp[Length] = {entries...};
		return AutoRegTable<Length>(temp);
	}

	namespace calib { namespace HV {
		auto Page0 = create_reg_table(
			RegEntry{0x00, 0x5a},
			 RegEntry{0x01, 0x00},
			 RegEntry{0x02, 0x4f},
			 RegEntry{0x03, 0x00},
			 RegEntry{0x04, 0x4f},
			 RegEntry{0x05, 0xa0},
			 RegEntry{0x06, 0x00},
			 RegEntry{0x07, 0x00},
			 RegEntry{0x08, 0x00},
			 RegEntry{0x09, 0x04},
			 RegEntry{0x0a, 0x74},
			 RegEntry{0x0b, 0x05},
			 RegEntry{0x0c, 0x08},
			 RegEntry{0x0d, 0x00},
			 RegEntry{0x0e, 0x00},
			 RegEntry{0x0f, 0x14},
			 RegEntry{0x10, 0x3c},
			 RegEntry{0x11, 0x41},
			 RegEntry{0x12, 0x0c},
			 RegEntry{0x13, 0x00},
			 RegEntry{0x14, 0x00},
			 RegEntry{0x15, 0x04},
			 RegEntry{0x16, 0x02},
			 RegEntry{0x17, 0x00},
			 RegEntry{0x18, 0x01},
			 RegEntry{0x19, 0xf4},
			 RegEntry{0x1a, 0x00},
			 RegEntry{0x1b, 0x00},
			 RegEntry{0x1c, 0x00},
			 RegEntry{0x1d, 0x00},
			 RegEntry{0x1e, 0x00},
			 RegEntry{0x1f, 0x00},
			 RegEntry{0x20, 0x00},
			 RegEntry{0x21, 0x80},
			 RegEntry{0x22, 0x06},
			 RegEntry{0x23, 0x00},
			 RegEntry{0x24, 0x00},
			 RegEntry{0x25, 0x00},
			 RegEntry{0x26, 0x00},
			 RegEntry{0x27, 0x00},
			 RegEntry{0x28, 0x00},
			 RegEntry{0x29, 0x04},
			 RegEntry{0x2a, 0x5f},
			 RegEntry{0x2b, 0xe2},
			 RegEntry{0x2c, 0xa0},
			 RegEntry{0x2d, 0x00},
			 RegEntry{0x2e, 0xff},
			 RegEntry{0x2f, 0x40},
			 RegEntry{0x30, 0x01},
			 RegEntry{0x31, 0x38},
			 RegEntry{0x32, 0x00},
			 RegEntry{0x33, 0x00},
			 RegEntry{0x34, 0x00},
			 RegEntry{0x35, 0x1f},
			 RegEntry{0x36, 0xff},
			 RegEntry{0x37, 0x00},
			 RegEntry{0x38, 0x00},
			 RegEntry{0x39, 0x00},
			 RegEntry{0x3a, 0x00}
		);

		auto Page1 = create_reg_table(
			 RegEntry{0x00, 0x7b},
			 RegEntry{0x01, 0x7f},
			 RegEntry{0x02, 0x77},
			 RegEntry{0x03, 0xd4},
			 RegEntry{0x04, 0x7d},
			 RegEntry{0x05, 0x19},
			 RegEntry{0x06, 0x80},
			 RegEntry{0x07, 0x40},
			 RegEntry{0x08, 0x11},
			 RegEntry{0x09, 0x00},
			 RegEntry{0x0a, 0x00},
			 RegEntry{0x0b, 0x14},
			 RegEntry{0x0c, 0x00},
			 RegEntry{0x0d, 0x00},
			 RegEntry{0x0e, 0x32},
			 RegEntry{0x0f, 0x02},
			 RegEntry{0x10, 0x08},
			 RegEntry{0x11, 0x6c},
			 RegEntry{0x12, 0x00},
			 RegEntry{0x13, 0x00},
			 RegEntry{0x14, 0x32},
			 RegEntry{0x15, 0x01},
			 RegEntry{0x16, 0x16},
			 RegEntry{0x17, 0x01},
			 RegEntry{0x18, 0x14},
			 RegEntry{0x19, 0x01},
			 RegEntry{0x1a, 0x16},
			 RegEntry{0x1b, 0x01},
			 RegEntry{0x1c, 0x17},
			 RegEntry{0x1d, 0x01},
			 RegEntry{0x1e, 0x0a},
			 RegEntry{0x1f, 0x01},
			 RegEntry{0x20, 0x0a},
			 RegEntry{0x21, 0x02},
			 RegEntry{0x22, 0x08},
			 RegEntry{0x23, 0x29},
			 RegEntry{0x24, 0x00},
			 RegEntry{0x25, 0x0c},
			 RegEntry{0x26, 0x1a},
			 RegEntry{0x27, 0x30},
			 RegEntry{0x28, 0x1a},
			 RegEntry{0x29, 0x30},
			 RegEntry{0x2a, 0x00},
			 RegEntry{0x2b, 0x00},
			 RegEntry{0x2c, 0x01},
			 RegEntry{0x2d, 0x16},
			 RegEntry{0x2e, 0x01},
			 RegEntry{0x2f, 0x17},
			 RegEntry{0x30, 0x03},
			 RegEntry{0x31, 0x2d},
			 RegEntry{0x32, 0x03},
			 RegEntry{0x33, 0x2d},
			 RegEntry{0x34, 0x14},
			 RegEntry{0x35, 0x00},
			 RegEntry{0x36, 0x00},
			 RegEntry{0x37, 0x00},
			 RegEntry{0x38, 0x00},
			 RegEntry{0x39, 0x03},
			 RegEntry{0x3a, 0xfe},
			 RegEntry{0x3b, 0x00},
			 RegEntry{0x3c, 0x00},
			 RegEntry{0x3d, 0x02},
			 RegEntry{0x3e, 0x00},
			 RegEntry{0x3f, 0x00}
		);
	}};

	namespace calib {
		/*
		 * 0, 5, 6, 7, default
		 *
		 *  
		 *                               05 60 06 c0 08       04 0a 97 0b 72 0c 69 0f 2b 11 2b 13 28 15 28 18 04 21 20 22 36 2a 4b
		 * 2a 07                         05 60 06 c0 07 80 08 04 0a 97 0b 72 0c 69 0f 2a 11 2a 13 27 15 67 18 04 21 20 22 36             2a 5f 2b c0       2e ff
		 * 2a 07                         05 60 06 c0 07 80 08 04 0a 97 0b 72 0c 69 0f 2a 11 2a 13 27 15 67 18 04 21 20 22 36             2a 5f 2b c0       2e ff
		 * 2a 07                         05 60 06 c0 07 80 08 04 0a 97 0b 72 0c 69 0f 2a 11 2a 13 27 15 67 18 04 21 20 22 36             2a 5f 2b c0       2e ff
		 * 2a 07 01 00 02 4f 03 00 04 4f 05 60 06 c0 07 80 08 04 0a 97 0b 72 0c 69 0f 2a 11 2a 13 27 15 67 18 04 21 20 22 36 29 02 2a 03 2a 5f 2b c0 2c 10 2e ff
		 *                               05 60 06 c0 07 80 08 04 0a 97 0b 72 0c 69 0f 2a 11 2a 13 27 15 67 18 04 21 20 22 36             2a 5f 2b c0       2e ff
		 */

		auto CalibId0 = create_reg_table(
			RegEntry{0x5,  0x60},
			RegEntry{0x6,  0xC0},
			RegEntry{0x8,  0x04},
			RegEntry{0xA,  0x97},
			RegEntry{0xB,  0x72},
			RegEntry{0xC,  0x69},
			RegEntry{0xF,  0x2B},
			RegEntry{0x11, 0x2B},
			RegEntry{0x13, 0x28},
			RegEntry{0x15, 0x28},
			RegEntry{0x18, 0x04},
			RegEntry{0x21, 0x20},
			RegEntry{0x2A, 0x4B}
		);

		auto CalibId5 = create_reg_table(
			RegEntry{0x2A, 0x07},
			
			// dac gain/calibration

			RegEntry{0x5,  0x60},
			RegEntry{0x6,  0xC0},
			
			// CTRL_REG_DAC_2?

			RegEntry{0x7,  0x80},

			RegEntry{0x8,  0x04},
			RegEntry{0xA,  0x97},
			RegEntry{0xB,  0x72},
			RegEntry{0xC,  0x69},
			RegEntry{0xF,  0x2A},
			RegEntry{0x11, 0x2A},
			RegEntry{0x13, 0x27},
			RegEntry{0x15, 0x67},
			RegEntry{0x18, 0x04},
			RegEntry{0x21, 0x20},
			RegEntry{0x22, 0x36},
			// apparently a mode register of some kind
			RegEntry{0x2A, 0x5F},
			RegEntry{0x2B, 0xC0},
			RegEntry{0x2E, 0xFF}
		);

		// Identical to CalibId5
		auto CalibId6 = create_reg_table(
			RegEntry{0x2A, 0x07},
			
			// dac gain/calibration

			RegEntry{0x5,  0x60},
			RegEntry{0x6,  0xC0},
			
			// CTRL_REG_DAC_2?

			RegEntry{0x7,  0x80},

			RegEntry{0x8,  0x04},
			RegEntry{0xA,  0x97},
			RegEntry{0xB,  0x72},
			RegEntry{0xC,  0x69},
			RegEntry{0xF,  0x2A},
			RegEntry{0x11, 0x2A},
			RegEntry{0x13, 0x27},
			RegEntry{0x15, 0x67},
			RegEntry{0x18, 0x04},
			RegEntry{0x21, 0x20},
			RegEntry{0x22, 0x36},
			RegEntry{0x2A, 0x5F},
			RegEntry{0x2B, 0xC0},
			RegEntry{0x2E, 0xFF}
		);

		// Identical to CalibId5
		auto CalibId7 = create_reg_table(
			RegEntry{0x2A, 0x07},
			
			// dac gain/calibration

			RegEntry{0x5,  0x60},
			RegEntry{0x6,  0xC0},
			
			// CTRL_REG_DAC_2?

			RegEntry{0x7,  0x80},

			RegEntry{0x8,  0x04},
			RegEntry{0xA,  0x97},
			RegEntry{0xB,  0x72},
			RegEntry{0xC,  0x69},
			RegEntry{0xF,  0x2A},
			RegEntry{0x11, 0x2A},
			RegEntry{0x13, 0x27},
			RegEntry{0x15, 0x67},
			RegEntry{0x18, 0x04},
			RegEntry{0x21, 0x20},
			RegEntry{0x22, 0x36},
			RegEntry{0x2A, 0x5F},
			RegEntry{0x2B, 0xC0},
			RegEntry{0x2E, 0xFF}
		);

		auto CalibId12 = create_reg_table(
			RegEntry{0x2a, 0x07},
			RegEntry{0x01, 0x00},
			RegEntry{0x02, 0x4f},
			RegEntry{0x03, 0x00},
			RegEntry{0x04, 0x4f},
			RegEntry{0x05, 0x60},
			RegEntry{0x06, 0xc0},
			RegEntry{0x07, 0x80},
			RegEntry{0x08, 0x04},
			RegEntry{0x0a, 0x97},
			RegEntry{0x0b, 0x72},
			RegEntry{0x0c, 0x69},
			RegEntry{0x0f, 0x2a},
			RegEntry{0x11, 0x2a},
			RegEntry{0x13, 0x27},
			RegEntry{0x15, 0x67},
			RegEntry{0x18, 0x04},
			RegEntry{0x21, 0x20},
			RegEntry{0x22, 0x36},
			RegEntry{0x29, 0x02},
			RegEntry{0x2a, 0x03},
			RegEntry{0x2a, 0x5f},
			RegEntry{0x2b, 0xc0},
			RegEntry{0x2c, 0x10},
			RegEntry{0x2e, 0xff}
		);

		auto CalibIdDefault = create_reg_table(
			RegEntry{0x05, 0x60},
			RegEntry{0x06, 0xc0},
			RegEntry{0x07, 0x80},
			RegEntry{0x08, 0x04},
			RegEntry{0x0a, 0x97},
			RegEntry{0x0b, 0x72},
			RegEntry{0x0c, 0x69},
			RegEntry{0x0f, 0x2a},
			RegEntry{0x11, 0x2a},
			RegEntry{0x13, 0x27},
			RegEntry{0x15, 0x67},
			RegEntry{0x18, 0x04},
			RegEntry{0x21, 0x20},
			RegEntry{0x22, 0x36},
			RegEntry{0x2a, 0x5f},
			RegEntry{0x2b, 0xc0},
			RegEntry{0x2e, 0xff}
		);

	};
}
